# Enable Gzip
gzip  on;
gzip_http_version 1.0;
gzip_comp_level 2;
gzip_min_length 1100;
gzip_buffers     4 8k;
gzip_proxied any;
gzip_types
  # text/html is always compressed by HttpGzipModule
  text/css
  text/javascript
  text/xml
  text/plain
  text/x-component
  application/javascript
  application/json
  application/xml
  application/rss+xml
  font/truetype
  font/opentype
  application/vnd.ms-fontobject
  image/svg+xml;

gzip_static on;
gzip_proxied        expired no-cache no-store private auth;
gzip_disable        "MSIE [1-6]\.";
gzip_vary           on;

server {
    listen  <%= ENV['OPENSHIFT_NGINX_IP'] %>:<%= ENV['OPENSHIFT_NGINX_PORT'] %>;
    root    <%= ENV['OPENSHIFT_REPO_DIR'] %>/public;
    server_name   <%= ENV['OPENSHIFT_APP_DNS'] %>;
    index   index.php index.html index.htm <%= ENV['NGINX_EXTRA_INDEX'] %>;

    real_ip_header    X-Forwarded-For;

    # avoid caching by proxies
    add_header        Cache-Control private;

    # php file goes straigth to backend
    location ~ \.php$ {
      try_files $uri =404;
      fastcgi_pass   unix:<%= ENV['OPENSHIFT_DATA_DIR'] %>hhvm.sock;
      fastcgi_index  index.php;

      # uncomment to export all environment variables to fastcgi
      #include        <%= ENV['OPENSHIFT_REPO_DIR'] %>/config/nginx.d/export_env;
    }
    # avoid unnecessary log
    location = /favicon.ico {
      access_log off;
      log_not_found off;
    }

    location = /robots.txt {
      access_log off;
      log_not_found off;
    }

    # Handle any other URI
    location / {
    #    try_files $uri $uri/ =404;
      try_files $uri $uri/ /index.php?$query_string;
    }
}
